
```{r table one - first part from UWES total score}
desc.table = data %>%
    pivot_longer(c("Gender","Education", "Family_status", "Religiosity","Work_position"),
                 names_to = "key", values_to = "value") %>%
    group_by(key,value) %>%
    summarise (mean = round(mean(UWES, na.rm = T),digits = 2),
               sd = round(sd(UWES, na.rm = T),digits = 2),
               n = n()) %>%
  mutate(percent = n / sum(n)*100)


data.to.exper = data %>%
    pivot_longer(c("Gender","Education","Family_status","Religiosity","Work_position"),
                 names_to = "key", values_to = "value") %>%
    group_by(key,value) %>%
    summarise (mean = round(mean(UWES, na.rm = T),digits = 2),
               sd = round(sd(UWES, na.rm = T),digits = 2),
               UWES = UWES,
               n = n()) %>% 
  mutate(percent = n / sum(n)*100) 

#..............................................................................................
# By the command below, there is need to explore, where are significnat differences between socio-demographic groups
#..............................................................................................
 stat.tab=
     data.to.exper %>%
     group_by(key) %>% 
     do(., kruskal.test(.$UWES~.$value) %>% tidy) %>% 
     mutate(UWES = "UWES") %>%
     mutate(firstrowforvar=T) %>% 
     select(key, UWES, statistic, parameter, p.value, firstrowforvar) 

 table1.categorical.both <- desc.table %>%
   group_by(key) %>%
   # we join on firstrowforvar to make sure we don't duplicate the tests
   mutate(firstrowforvar=row_number()==1) %>%
   left_join(., stat.tab, by=c("key", "firstrowforvar")) %>%
   # this is gross, but we don't want to repeat the variable names in our table
   ungroup() %>%
   mutate(Variables = ifelse(firstrowforvar==T, as.character(key), NA)) %>%
   select(Variables, value, n, percent,mean,sd, statistic, parameter, p.value)
#..............................................................................................
# there are significat differences in: Education, Family status and work_position 
#..............................................................................................
 
# removing results of Kruscal-Wallis test
table1.categorical.both = table1.categorical.both %>% 
  select(Variables,value,n, percent,mean,sd) %>% 
  mutate(mean = str_replace(mean, "NaN", NA_character_)) %>% 
  janitor::remove_empty(which = c("rows")) %>% 
  filter(!is.na(value) & !is.na(mean)) # removing missing values
#.............................................................................
#.............................................................................
# post hoc testing
#.............................................................................
#.............................................................................
# Games-Howell for Education 
oa.edu=rstatix::games_howell_test(UWES ~ Education, data = data, detailed = T) 
# Dunn test 
dunn.test(data$UWES, data$Education, list = T, altp = T, method = "bonferroni", kw=T, label = T, table = T)
# selecting significnat results from Games-Howell
edu.join=oa.edu %>% filter(p.adj < 0.05) %>%
  select(group1,group2,df,statistic,p.adj) %>%
  rename(value=group1)
#  Merging into table 1  
table.continuous =
  full_join(table1.categorical.both, edu.join)
# merging ES into table 1 
# extracting significant comparistons from the Post-hoc test
edu.es.g=oa.edu %>%
  filter(p.adj < 0.05) %>% 
  select(group1,group2)
# extracting ES from VDA
ES.edu=multiVDA(x = data$UWES, g = data$Education, statistic = "VDA", digits = 2) %>%
  as.data.frame() %>%
  separate(col = pairs.Comparison, sep = " - ", into = c("group1","group2")) %>% 
  filter(group1 == edu.es.g$group1 & group2 == edu.es.g$group2) %>%  
  select(group1,group2,pairs.VDA) %>% 
  rename(value = group1)
#  Merging into table 1  
table.continuous =
  full_join(table.continuous, ES.edu)
#................................................
# Family status 
#................................................
# Games-Howell for Family status 
uwes.fs=rstatix::games_howell_test(UWES ~ Family_status, data = data, detailed = T) 
# Dunn test 
# du=FSA::dunnTest(UWES~ Family_status,data = data, method="bonferroni")
# du=du$res %>% as_tibble()
# after post hoc testing, the resutls were not significant
#................................................
# Work_position
#................................................
# Dunn test 
dunn.test(data$UWES, data$Work_position, list = T, altp = T, method = "bonferroni", kw=T, label = T, table = T)
# Games-Howell for Work_position 
uwes.wp=rstatix::games_howell_test(UWES ~ Work_position, data = data, detailed = T) 
# selecting significnat results from Games-Howell
uwes.join=uwes.wp %>% filter(p.adj < 0.05) %>%
  select(group1,group2,df,statistic,p.adj) %>%
  rename(value=group1)
#  Merging into table 1  
table.continuous.2 =
  full_join(table1.categorical.both, uwes.join)
# merging ES into table 1 
# extracting significant comparistons from the Post-hoc test
wp.es.g=uwes.wp %>%
  filter(p.adj < 0.05) %>% 
  select(group1,group2)
# extracting ES from VDA
ES.wp=multiVDA(x = data$UWES, g = data$Work_position, statistic = "VDA", digits = 2) %>%
  as.data.frame() %>%
  separate(col = pairs.Comparison, sep = " - ", into = c("group1","group2")) %>% 
  filter(group1 == wp.es.g$group1 & group2 == wp.es.g$group2) %>%  
  select(group1,group2,pairs.VDA) %>% 
  rename(value = group1)
#  Merging into table 1  
table.continuous.2 =
  full_join(table.continuous.2, ES.wp)

# removing empty rows and NaNs 
two.var.tab=full_join(table.continuous, table.continuous.2) %>%
    mutate(mean = str_replace(mean, "NaN", NA_character_)) %>% 
  janitor::remove_empty(which = c("rows"))

# removing duplicites
two.var.tab = two.var.tab %>%
  group_by(Variables, value) %>% 
  mutate(duplicate = n()) %>% # count number of duplicite cases
  mutate(to.rm = ifelse(duplicate > 1 & is.na(group2),TRUE,FALSE)) %>%  
  filter(to.rm == FALSE) %>% 
  ungroup() %>% 
  select(!c("to.rm","duplicate"))

# sorting working status - extracting positions from original data frame
  sort.bypos = data$Work_position %>% levels()  # selecting order based on which we want to sort variable
  
# arranging
  two.var.tab = two.var.tab %>% 
  arrange(factor(value, levels = sort.bypos)) %>%  
# removing duplicate variable names
  mutate(to.rm2 = ifelse(duplicated(Variables) & !is.na(Variables),TRUE,FALSE)) %>% 
  mutate(Variables = ifelse(to.rm2 == TRUE,NA_character_, Variables)) %>% 
  select(!c("to.rm2"))
#................................
# formating table
#...............................
two.var.tab %>% 
  mutate("M(sd)" = paste0("","(",mean,"Â±",sd,")"),
         "n(%)" = paste0("",n," ","(",round(percent,digits = 0),"%)"),
         Group_difference = paste0("",group2,": ","x2(",round(df,digits = 0),")","=",round(statistic,digits = 2),", ", format_p(p.adj),", A=",
                                   pairs.VDA),
         Group_difference = str_replace(Group_difference, pattern = "(?<=^NA:)( .*)", replacement = " "),
         Group_difference = str_replace(Group_difference, pattern = "^NA:", replacement = " ")) %>% 
  select(Variables,value,"n(%)","M(sd)",Group_difference) %>% view()
  
```
